<?php

use Mockery as m;
use Recca0120\String\Str;

class NativeTest extends PHPUnit_Framework_TestCase
{
    public function tearDown()
    {
        m::close();
    }

    public function test_trim()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        $string = ' foo  ';

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        $string = new Str($string);

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame('foo', (string) $string->trim());
    }

    public function test_to_upper_case()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame('FOO', (string) (new Str('foo'))->toUpperCase());
    }

    public function test_to_lower_case()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame('foo', (string) (new Str('FOO'))->toLowerCase());
    }

    public function test_replace()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        $string = 'foo';

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame('baa', (string) (new Str($string))->replace(['f' => 'b', 'o' => 'a']));
        $this->assertSame('bar', (string) (new Str($string))->replace('/foo/', function ($m) {
            $this->assertSame('foo', $m[0]);

            return 'bar';
        }));
        $this->assertSame('bar', (string) (new Str($string))->replace('/foo/', 'bar'));
    }

    public function test_match()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        $string = 'abcdef';
        $pattern = '/[a-z]?/';

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame([['a', 'b', 'c', 'd', 'e', 'f', '']], (new Str($string))->match($pattern));
        $this->assertFalse((new Str('123'))->match('/[a-z]/'));
    }

    public function test_encoding()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        $string = 'abcdef';

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame(mb_convert_encoding($string, 'big5'), (string) (new Str($string))->encoding('big5'));
    }

    public function test_length()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        $string = 'abcdef';

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame(6, (new Str($string))->length());
    }

    public function test_substr()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        $string = 'abcdef';

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame('bcd', (string) (new Str($string))->substr(1, 3));
    }

    public function test_explode()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        $string = 'abcdef';

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame(['a', 'cdef'], (new Str($string))->explode('b'));
    }

    public function test_prepend()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        $string = 'abcdef';

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame('z'.$string, (string) (new Str($string))->prepend('z'));
    }

    public function test_append()
    {
        /*
        |------------------------------------------------------------
        | Arrange
        |------------------------------------------------------------
        */

        $string = 'abcdef';

        /*
        |------------------------------------------------------------
        | Act
        |------------------------------------------------------------
        */

        /*
        |------------------------------------------------------------
        | Assert
        |------------------------------------------------------------
        */

        $this->assertSame($string.'z', (string) (new Str($string))->append('z'));
    }
}
